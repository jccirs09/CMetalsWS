@inherits LayoutComponentBase

<MudThemeProvider Theme="_customTheme" @bind-IsDarkMode="_isDarkMode" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="2" Class="z-appbar">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" OnClick="@(()=>_drawerOpen=!_drawerOpen)" />
        <MudText Typo="Typo.h5" Class="ml-3">Application</MudText>
        <MudSpacer />
        @if (!ChatState.IsChatPageOpen)
        {
            <MudIconButton @ref="_messagesBtnRef"
                           Icon="@Icons.Material.Filled.Message"
                           AriaLabel="Open messages"
                           OnClick="ChatState.ToggleThreadPanel" />
        }
        <MudIconButton Icon="@Icons.Material.Filled.Notifications" />
        <MudMenu Icon="@Icons.Material.Filled.Person">
            <MudMenuItem Link="/profile">Profile</MudMenuItem>
            <MudMenuItem OnClick="Logout">Logout</MudMenuItem>
        </MudMenu>
    </MudAppBar>

    <MudDrawer @bind-Open="_drawerOpen" ClipMode="DrawerClipMode.Always" Elevation="2">
        <NavMenu />
    </MudDrawer>

    <MudMainContent Class="pt-16 pa-4">
        @Body
    </MudMainContent>

</MudLayout>

@if (!ChatState.IsChatPageOpen)
{
    <MudPopover Open="ChatState.IsThreadPanelOpen"
                Class="z-chat-popover"
                AnchorReference="PopoverAnchorReference.Element"
                AnchorEl="_messagesBtnRef?.Ref"
                AnchorOrigin="Origin.BottomRight"
                TransformOrigin="Origin.TopRight"
                Fixed="true"
                CloseOnOutsideClick="true"
                OnClose="ChatState.ToggleThreadPanel">
        <ChatThreadsPanel />
    </MudPopover>

    <div class="chat-dock-host">
        @foreach (var threadId in ChatState.OpenDocks)
        {
            <ChatThreadWindow ThreadId="@threadId"
                              OnClose="() => ChatState.CloseDock(threadId)" />
        }
    </div>
}

<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">🗙</span>
</div>
