@using CMetalsWS.Data
@using CMetalsWS.Services
@using MudBlazor
@inject InventoryService InvService

<MudDialog Title="Work Order Details">
    <DialogContent>
        <MudForm>
            <MudStack Spacing="3">
                <MudCard>
                    <MudCardHeader><CardHeaderContent><MudText Typo="Typo.h6">Pull Info</MudText></CardHeaderContent></MudCardHeader>
                    <MudCardContent>
                        <MudGrid>
                            <MudItem xs="12" sm="6"><MudText><b>Tag Number:</b> @Model.TagNumber</MudText></MudItem>
                            <MudItem xs="12" sm="6"><MudText><b>Weight:</b> @_parentItem?.Snapshot</MudText></MudItem>
                            <MudItem xs="12" sm="6"><MudText><b>Location:</b> @_parentItem?.Location</MudText></MudItem>
                            <MudItem xs="12" sm="6"><MudText><b>Description:</b> @_parentItem?.Description</MudText></MudItem>
                        </MudGrid>
                    </MudCardContent>
                </MudCard>

                <MudCard>
                    <MudCardHeader><CardHeaderContent><MudText Typo="Typo.h6">Picking List</MudText></CardHeaderContent></MudCardHeader>
                    <MudCardContent>
                        <MudTable Items="Model.Items" Dense="true" Hover="true">
                            <HeaderContent>
                                <MudTh>Sales Order #</MudTh>
                                <MudTh>Customer</MudTh>
                                <MudTh>Order Quantity</MudTh>
                                <MudTh>Length</MudTh>
                                <MudTh>Width</MudTh>
                            </HeaderContent>
                            <RowTemplate>
                                <MudTd DataLabel="Sales Order #">@context.SalesOrderNumber</MudTd>
                                <MudTd DataLabel="Customer">@context.CustomerName</MudTd>
                                <MudTd DataLabel="Order Quantity">@context.OrderQuantity</MudTd>
                                <MudTd DataLabel="Length">@context.Length</MudTd>
                                <MudTd DataLabel="Width">@context.Width</MudTd>
                            </RowTemplate>
                        </MudTable>
                    </MudCardContent>
                </MudCard>
            </MudStack>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Text" OnClick="Cancel">Close</MudButton>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="Edit">Edit</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] public IMudDialogInstance MudDialog { get; set; } = default!;
    [Parameter] public WorkOrder Model { get; set; } = new();

    private InventoryItem? _parentItem;

    protected override async Task OnInitializedAsync()
    {
        if (!string.IsNullOrEmpty(Model.TagNumber))
        {
            _parentItem = await InvService.GetByTagNumberAsync(Model.TagNumber);
        }
    }

    private void Cancel() => MudDialog.Cancel();

    private void Edit()
    {
        MudDialog.Close(DialogResult.Ok(true));
    }
}
