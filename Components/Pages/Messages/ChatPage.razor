@page "/messages"
@page "/messages/{ThreadId}"
@using CMetalsWS.Services
@using CMetalsWS.Data.Chat
@inject ChatStateService ChatState
@implements IDisposable

<MudGrid Class="h-100 pa-3" Style="min-height:calc(100vh - 128px)">
  <MudItem xs="12" md="4" lg="3">
    <ChatThreadList OnThreadSelected="OpenThread" />
  </MudItem>

  <MudItem xs="12" md="8" lg="9">
    @if (!string.IsNullOrWhiteSpace(ChatState.ActiveThreadId))
    {
      <ChatConversation ThreadId="ChatState.ActiveThreadId" />
    }
    else
    {
      <MudPaper Class="d-flex align-center justify-center" Style="height:70vh;">
        <MudText Typo="Typo.h6" Class="mud-text-secondary">
          Select a conversation to start chatting
        </MudText>
      </MudPaper>
    }
  </MudItem>
</MudGrid>

@code {
  [Parameter] public string? ThreadId { get; set; }

  protected override void OnInitialized()
  {
    ChatState.OnChange += StateHasChanged;
  }

  private void OpenThread(ThreadSummary t)
  {
    ChatState.HandleThreadClick(t);
  }

  public void Dispose()
  {
    ChatState.OnChange -= StateHasChanged;
  }
}
